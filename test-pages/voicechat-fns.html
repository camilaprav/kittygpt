<body>
  <button id="start" style="color: inherit">Start Voice Chat</button>
  <script src="/mespeak/mespeak.js"></script>
  <script>
    meSpeak.loadVoice("voices/en/en-us.json", (success, err) => {
      if (!success) throw new Error(err);
      meSpeak.ready = true;
    });
  </script>
  <script type="module">
    import voicechat from '../voicechat.js';
    window.fncalled = false;
    window.transcript = '';
    document.querySelector('#start').onclick = async ev => {
      ev.target.disabled = true;
      let session = await voicechat({ transcript: x => transcript += x });
      session.sysupdate(null, {
        sampleFunction: {
          handler: () => {
            fncalled = true;
            return { success: true, respond: !location.hash.includes('respond=fnfalse') };
          },
          respond: !location.hash.includes('respond=false'),
        },
      });
      session.prompt(`Call the sample function.`);
    };
  </script>
</body>
